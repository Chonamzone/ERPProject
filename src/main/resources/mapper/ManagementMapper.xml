<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.chonamzone.erpproject.mapper.ManagementMapper">	<!-- xml파일을 사용할 mapper가 있는 경로 -->
	<!-- <resultMap id="DocumentListResultMap" type="com.chonamzone.myerpproject.model.DocumentListDTO$MapperData">
		<id property="dSeq" column="d_seq" />
		<result property="dDraftingDate" column="d_drafting_date" />
		<result property="dStatus" column="d_status" />
		<result property="dDrafterId" column="d_drafter_id" />
		<result property="dCategory" column="d_category" />
		<collection property="approversList" ofType="ApproversDTO">
			<id property="aSeq" column="a_seq" />
			<result property="aOrderNum" column="a_order_num" />
			<result property="aApproverId" column="a_approver_id" />
			<result property="aApproverState" column="a_approver_state" />
			<result property="dSeq" column="d_seq" />
		</collection> 
	</resultMap> -->
	
	<resultMap id="ManagementListResultMap" type="com.chonamzone.erpproject.model.DocumentListDTO$MapperData">
		<id property="dSeq" column="d_seq" />
		<result property="dDraftingDate" column="d_drafting_date" />
		<result property="dStatus" column="d_status" />
		<result property="dDrafterId" column="d_drafter_id" />
		<result property="dCategory" column="d_category" />
		<result property="aApproverId" column="a_approver_id" />
		<result property="aOrderNum" column="a_order_num" />
		<result property="aApproverState" column="a_approver_state" />

	</resultMap>

	
	<select id="getManagementList" resultMap="ManagementListResultMap" parameterType="java.util.Map">
		SELECT *
		FROM (
			SELECT 
				ROWNUM AS rn,
				d.d_seq,
				d.d_drafting_date, 
				d.d_status, 
				d.d_drafter_id,
				d.d_category, 
				a.a_order_num, 
				a.a_approver_id, 
				a.a_approver_state
			FROM document_list d
			LEFT JOIN approvers a
			on d.d_seq = a.d_seq
		)
		WHERE rn &gt;= #{startPage}
		AND rn &lt;= #{endPage}
	</select>  

	<select id="getTravelByDSeq" resultType="TravelDTO" parameterType="int">
		SELECT *
		FROM travels
		WHERE d_seq = #{dSeq}
	</select>
	
	
	<select id="getVacationByDSeq" resultType="VacationDTO" parameterType="int">
		SELECT *
		FROM vacations
		WHERE d_seq = #{dSeq}
	</select>
	
	<select id="getApproverDetailsListByDSeq" resultType="com.chonamzone.erpproject.model.ApproversDTO$Details" parameterType="int">
		SELECT a.a_approver_id, u.u_name AS u_name, p.p_name AS p_name
		FROM approvers a
		INNER JOIN users u ON a.a_approver_id = u.u_id
		INNER JOIN partnames p ON u.p_id = p.p_id
		WHERE a.d_seq = #{dSeq}
	</select>
	

</mapper>